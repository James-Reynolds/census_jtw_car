---
title: "Bayside census analysis"
runningheader: "Bayside census analysis" # only for pdf output
subtitle: "Working note" # only for html output
author: "Dr James Reynolds"
date: "`r Sys.Date()`"
output:
  tufte::tufte_html: default
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
bibliography: skeleton.bib
link-citations: yes
---

```{r setup, include=FALSE}
library(dplyr)
library(ggstatsplot)
library(gtsummary)
library(janitor)
library(knitr)
library(kableExtra)
library(readr)
library(tidyverse)
library(tufte)
# invalidate cache when the tufte version changes
knitr::opts_chunk$set(cache.extra = packageVersion('tufte'))
options(htmltools.dir.version = FALSE)
```

# Introduction
The Public Transport Research Group (PTRG) is reviewing census data for 2011, 2016 and 2021 for Greater Melbourne and the City of Bayside. Journey to work travel, mode and total cars per person are the particular areas of interest.  

This working note details the analysis and results. 

# Methodology
Australian Bureau of Statistics (ABS) census data was obtained using the TableBuilder platform. Details are as follows


## Population and population over 18

Population of driving age was extracted from the census results that are enumerated by place of usual residence. Data was loaded and cleaned for 2011, 2016 and 2021.


```{r population_load_data, message=FALSE, warning=FALSE, echo=FALSE}

gccsa_ur_agep_2021 <- read_csv("data/gccsa_ur_agep_2021.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
gccsa_ur_agep_2021 <- gccsa_ur_agep_2021[-1,]
gccsa_ur_agep_2021 <- gccsa_ur_agep_2021[1:34,1:118]
gccsa_ur_agep_2021 <- gccsa_ur_agep_2021 %>% clean_names()

gccsa_ur_agep_2016 <- read_csv("data/gccsa_ur_agep_2016.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
gccsa_ur_agep_2016 <- gccsa_ur_agep_2016[-1,]
gccsa_ur_agep_2016 <- gccsa_ur_agep_2016[1:34,1:118]
gccsa_ur_agep_2016 <- gccsa_ur_agep_2016 %>% clean_names()

gccsa_ur_agep_2011 <- read_csv("data/gccsa_ur_agep_2011.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
gccsa_ur_agep_2011 <- gccsa_ur_agep_2011[-1,]
gccsa_ur_agep_2011 <- gccsa_ur_agep_2011[1:34,1:118]
gccsa_ur_agep_2011 <- gccsa_ur_agep_2011 %>% clean_names()

lga_ur_agep_2021 <- read_csv("data/lga_ur_agep_2021.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
lga_ur_agep_2021 <- lga_ur_agep_2021[-1,]
lga_ur_agep_2021 <- lga_ur_agep_2021[1:565,1:118]
lga_ur_agep_2021 <- lga_ur_agep_2021 %>% clean_names()

lga_ur_agep_2016 <- read_csv("data/lga_ur_agep_2016.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
lga_ur_agep_2016 <- lga_ur_agep_2016[-1,]
lga_ur_agep_2016 <- lga_ur_agep_2016[1:563,1:118]
lga_ur_agep_2016 <- lga_ur_agep_2016 %>% clean_names()

lga_ur_agep_2011 <- read_csv("data/lga_ur_agep_2011.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
lga_ur_agep_2011 <- lga_ur_agep_2011[-1,]
lga_ur_agep_2011 <- lga_ur_agep_2011[1:577,1:118]
lga_ur_agep_2011 <- lga_ur_agep_2011 %>% clean_names()

#fix column names
colnames(gccsa_ur_agep_2021)[colnames(gccsa_ur_agep_2021) == "agep_age"] <- "area_of_interest"
colnames(gccsa_ur_agep_2016)[colnames(gccsa_ur_agep_2016) == "agep_age"] <- "area_of_interest"
colnames(gccsa_ur_agep_2011) <- colnames(gccsa_ur_agep_2016)
colnames(lga_ur_agep_2021)[colnames(lga_ur_agep_2021) == "agep_age"] <- "area_of_interest"
colnames(lga_ur_agep_2016)[colnames(lga_ur_agep_2016) == "agep_age"] <- "area_of_interest"
colnames(lga_ur_agep_2011) <- colnames(lga_ur_agep_2016)

#fix variable types
gccsa_ur_agep_2021 <- gccsa_ur_agep_2021 %>% type.convert(as.is = T)
gccsa_ur_agep_2016 <- gccsa_ur_agep_2016 %>% type.convert(as.is = T)
gccsa_ur_agep_2011 <- gccsa_ur_agep_2011 %>% type.convert(as.is = T)
lga_ur_agep_2021 <- lga_ur_agep_2021 %>% type.convert(as.is = T)
lga_ur_agep_2016 <- lga_ur_agep_2016 %>% type.convert(as.is = T)
lga_ur_agep_2011 <- lga_ur_agep_2011 %>% type.convert(as.is = T)



```

## Cars per dwelling
The number of cars is enumerated in the census for each dwelling^[See https://www.abs.gov.au/census/guide-census-data/census-dictionary/2021/variables-topic/transport/number-motor-vehicles-vehd]. Data was loaded and cleaned for 2011, 2016 and 2021.

```{r cars_per_dwelling_load_data, message=FALSE, warning=FALSE, echo=FALSE}

gccsa_dw_vehd_2021 <- read_csv("data/gccsa_dw_vehd_2021.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
gccsa_dw_vehd_2021 <- gccsa_dw_vehd_2021[-1,]
gccsa_dw_vehd_2021 <- gccsa_dw_vehd_2021[1:25,1:34]
gccsa_dw_vehd_2021 <- gccsa_dw_vehd_2021 %>% clean_names()

gccsa_dw_vehd_2016 <- read_csv("data/gccsa_dw_vehd_2016.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
gccsa_dw_vehd_2016 <- gccsa_dw_vehd_2016[-1,]
gccsa_dw_vehd_2016 <- gccsa_dw_vehd_2016[1:25,1:34]
gccsa_dw_vehd_2016 <- gccsa_dw_vehd_2016 %>% clean_names()

gccsa_dw_vehd_2011 <- read_csv("data/gccsa_dw_vehd_2011.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
gccsa_dw_vehd_2011 <- gccsa_dw_vehd_2011[-1,]
gccsa_dw_vehd_2011 <- gccsa_dw_vehd_2011[1:25,1:34]
gccsa_dw_vehd_2011 <- gccsa_dw_vehd_2011 %>% clean_names()


lga_dw_vehd_2021 <- read_csv("data/lga_dw_vehd_2021.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
lga_dw_vehd_2021 <- lga_dw_vehd_2021[-1,]
lga_dw_vehd_2021 <- lga_dw_vehd_2021[1:556,1:34]
lga_dw_vehd_2021 <- lga_dw_vehd_2021 %>% clean_names()


lga_dw_vehd_2016 <- read_csv("data/lga_dw_vehd_2016.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
lga_dw_vehd_2016 <- lga_dw_vehd_2016[-1,]
lga_dw_vehd_2016 <- lga_dw_vehd_2016[1:554,1:34]
lga_dw_vehd_2016 <- lga_dw_vehd_2016 %>% clean_names()


lga_dw_vehd_2011 <- read_csv("data/lga_dw_vehd_2011.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
lga_dw_vehd_2011 <- lga_dw_vehd_2011[-1,]
lga_dw_vehd_2011 <- lga_dw_vehd_2011[1:568,1:34]
lga_dw_vehd_2011 <- lga_dw_vehd_2011 %>% clean_names()

```

## Journey to work

```{r jtw_load_data, message=FALSE, warning=FALSE, echo=FALSE}

gccsa_ur_mtwp_2021 <- read_csv("data/gccsa_ur_mtwp_2021.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
gccsa_ur_mtwp_2021 <- gccsa_ur_mtwp_2021[-1,]
gccsa_ur_mtwp_2021 <- gccsa_ur_mtwp_2021[1:34,1:237]
gccsa_ur_mtwp_2021 <- gccsa_ur_mtwp_2021 %>% clean_names()


gccsa_ur_mtwp_2016 <- read_csv("data/gccsa_ur_mtwp_2016.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
gccsa_ur_mtwp_2016 <- gccsa_ur_mtwp_2016[-1,]
gccsa_ur_mtwp_2016 <- gccsa_ur_mtwp_2016[1:34,1:237]
gccsa_ur_mtwp_2016 <- gccsa_ur_mtwp_2016 %>% clean_names()


gccsa_ur_mtwp_2011 <- read_csv("data/gccsa_ur_mtwp_2011.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
gccsa_ur_mtwp_2011 <- gccsa_ur_mtwp_2011[-1,]
gccsa_ur_mtwp_2011 <- gccsa_ur_mtwp_2011[1:34,1:237]
gccsa_ur_mtwp_2011 <- gccsa_ur_mtwp_2011 %>% clean_names()


lga_ur_mtwp_2021 <- read_csv("data/lga_ur_mtwp_2021.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
lga_ur_mtwp_2021 <- lga_ur_mtwp_2021[-1,]
lga_ur_mtwp_2021 <- lga_ur_mtwp_2021[1:565,1:237]
lga_ur_mtwp_2021 <- lga_ur_mtwp_2021 %>% clean_names()


lga_ur_mtwp_2016 <- read_csv("data/lga_ur_mtwp_2016.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
lga_ur_mtwp_2016 <- lga_ur_mtwp_2016[-1,]
lga_ur_mtwp_2016 <- lga_ur_mtwp_2016[1:563,1:237]
lga_ur_mtwp_2016 <- lga_ur_mtwp_2016 %>% clean_names()

lga_ur_mtwp_2011 <- read_csv("data/lga_ur_mtwp_2011.csv", 
    skip = 8)
#remove unneeded rows and columns and clean names
lga_ur_mtwp_2011 <- lga_ur_mtwp_2011[-1,]
lga_ur_mtwp_2011 <- lga_ur_mtwp_2011[1:577,1:237]
lga_ur_mtwp_2011 <- lga_ur_mtwp_2011 %>% clean_names()




#fix column names
colnames(gccsa_ur_mtwp_2021)[colnames(gccsa_ur_mtwp_2021) == "x3_digit_level_mtwp_method_of_travel_to_work"] <- "area_of_interest"
colnames(lga_ur_mtwp_2021)[colnames(lga_ur_mtwp_2021) == "x3_digit_level_mtwp_method_of_travel_to_work"] <- "area_of_interest"
colnames(gccsa_ur_mtwp_2016)[colnames(gccsa_ur_mtwp_2016) == "mtwp_method_of_travel_to_work"] <- "area_of_interest"
colnames(lga_ur_mtwp_2016)[colnames(lga_ur_mtwp_2016) == "mtwp_method_of_travel_to_work"] <- "area_of_interest"
colnames(gccsa_ur_mtwp_2011)[colnames(gccsa_ur_mtwp_2011) == "mtwp_method_of_travel_to_work"] <- "area_of_interest"
colnames(lga_ur_mtwp_2011)[colnames(lga_ur_mtwp_2011) == "mtwp_method_of_travel_to_work"] <- "area_of_interest"


#fix variable types
gccsa_ur_mtwp_2021 <- gccsa_ur_mtwp_2021 %>% type.convert(as.is = T)
lga_ur_mtwp_2021 <- lga_ur_mtwp_2021 %>% type.convert(as.is = T)
gccsa_ur_mtwp_2016 <- gccsa_ur_mtwp_2016 %>% type.convert(as.is = T)
lga_ur_mtwp_2016 <- lga_ur_mtwp_2016 %>% type.convert(as.is = T)
gccsa_ur_mtwp_2011 <- gccsa_ur_mtwp_2011 %>% type.convert(as.is = T)
lga_ur_mtwp_2011 <- lga_ur_mtwp_2011 %>% type.convert(as.is = T)

#check variable types
#lapply(gccsa_ur_mtwp_2021, class) %>% as_vector() %>% tabyl()
#lapply(gccsa_ur_mtwp_2016, class) %>% as_vector() %>% tabyl()
#lapply(gccsa_ur_mtwp_2011, class) %>% as_vector() %>% tabyl()
#lapply(lga_ur_mtwp_2021, class) %>% as_vector() %>% tabyl()
#lapply(lga_ur_mtwp_2016, class) %>% as_vector() %>% tabyl()
#lapply(lga_ur_mtwp_2011, class) %>% as_vector() %>% tabyl()


```



# Results


## Population and population 18 and over

The following tables and figures show the population that is 18 years and older and the total populations in both the City of Bayside and the rest of Greater Melbourne. 

```{r population_of_driving_age_summarise_data, message=FALSE, warning=FALSE, echo=FALSE, fig.caption = "Total population 18 and older"}

driving_age_summary_table <- gccsa_ur_agep_2021 %>%
  filter(area_of_interest == "Greater Melbourne")
driving_age_summary_table <- driving_age_summary_table %>% 
  add_row(gccsa_ur_agep_2016 %>%
  filter(area_of_interest == "Greater Melbourne"))
driving_age_summary_table <- driving_age_summary_table %>% 
  add_row(gccsa_ur_agep_2011 %>%
  filter(area_of_interest == "Greater Melbourne"))
driving_age_summary_table <- driving_age_summary_table %>% 
  add_row(lga_ur_agep_2021 %>%
  filter(area_of_interest == "Bayside (Vic.)"))
driving_age_summary_table <- driving_age_summary_table %>% 
  add_row(lga_ur_agep_2016 %>%
  filter(area_of_interest == "Bayside (C)"))
driving_age_summary_table <- driving_age_summary_table %>% 
  add_row(lga_ur_agep_2011 %>%
  filter(area_of_interest == "Bayside (C)"))

driving_age_summary_table$Year <- c(2021, 2016, 2011, 2021, 2016, 2011)

#replace first column with consistent place names
driving_age_summary_table[["area_of_interest"]] <- c("Greater Melbourne", "Greater Melbourne", "Greater Melbourne", "Bayside", "Bayside", "Bayside")

driving_age_summary_table$driving_age_population <- driving_age_summary_table[,20:117] %>% rowSums()


total_population_summary_table <- driving_age_summary_table %>% 
  select(area_of_interest, Year, total)


driving_age_summary_table <- driving_age_summary_table %>% 
  select(area_of_interest, Year, driving_age_population)

driving_age_summary_table_wider <- driving_age_summary_table %>% 
  select(area_of_interest, Year, driving_age_population) %>% 
  pivot_wider(
  names_from = area_of_interest, 
  values_from = driving_age_population
)


driving_age_summary_table_wider$`Rest of Greater Melbourne` <- driving_age_summary_table_wider$`Greater Melbourne` - driving_age_summary_table_wider$Bayside
 
driving_age_summary_table_wider <- driving_age_summary_table_wider %>% 
  select(Year, Bayside, `Rest of Greater Melbourne`)

driving_age_summary_table_wider$Year <- driving_age_summary_table_wider$Year %>%   factor(levels = c("2011", "2016", "2021")) 

driving_age_summary_table_wider <- driving_age_summary_table_wider %>% 
  arrange(Year)

driving_age_summary_table_wider %>%   
  adorn_totals(where = "col") %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>%
  kable(caption = "Total population 18 and older", 
        align = 'lrr', 
        format.args = list(big.mark = ","))

 ggbarstats(driving_age_summary_table_wider %>% pivot_longer(
    cols = 2:3,
    names_to = "area_of_interest", 
    values_to = "Total population 18 and older"),
  y = Year, 
  x = area_of_interest, 
  counts = "Total population 18 and older")

```
 



```{r population_total_summarise_data, message=FALSE, warning=FALSE, echo=FALSE, fig.caption = "Total population"}

 
#### Total Popluation 
 
total_population_summary_table_wider <- total_population_summary_table %>% 
  pivot_wider(
  names_from = area_of_interest, 
  values_from = total
)


total_population_summary_table_wider$`Rest of Greater Melbourne` <- total_population_summary_table_wider$`Greater Melbourne` - total_population_summary_table_wider$Bayside
 
total_population_summary_table_wider <- total_population_summary_table_wider %>% 
  select(Year, Bayside, `Rest of Greater Melbourne`)

total_population_summary_table_wider$Year <- total_population_summary_table_wider$Year %>%   factor(levels = c("2011", "2016", "2021")) 

total_population_summary_table_wider <- total_population_summary_table_wider %>% 
  arrange(Year)

total_population_summary_table_wider %>%   
  adorn_totals(where = "col") %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>%
  kable(caption = "Total population", 
        align = 'lrr', 
        format.args = list(big.mark = ","))

 ggbarstats(total_population_summary_table_wider %>% pivot_longer(
    cols = 2:3,
    names_to = "area_of_interest", 
    values_to = "Total population"),
  y = Year, 
  x = area_of_interest, 
  counts = "Total population")
```

The following tables and figures compare the share of the population that is over or under the age of 18. 

```{r population_comparisons, message=FALSE, warning=FALSE, echo=FALSE, fig.caption = "Population share: younger than 18 compared to 18 and over", fig.fullwidth = TRUE, fig.height = 10}

 population_comparison_table <- driving_age_summary_table_wider %>%
   adorn_totals(where = "col")
 population_comparison_table$total_population_bayside <- total_population_summary_table_wider$Bayside
  population_comparison_table$total_population_rest_of_greater_melbourne <- total_population_summary_table_wider$`Rest of Greater Melbourne`
 population_comparison_table$total_population_greater_melbourne <- 
   total_population_summary_table_wider$Bayside +
   total_population_summary_table_wider$`Rest of Greater Melbourne`
   
names(population_comparison_table) <- c(
  "Year", 
  "x18plus_bayside", 
  "x18plus_rest_of_melbourne", 
  "x18plus_greater_melbourne", 
  "total_population_bayside", 
  "total_population_rest_of_melbourne", 
  "total_population_greater_melbourne") 

population_comparison_table$x18plus_share_bayside <- population_comparison_table$x18plus_bayside / population_comparison_table$total_population_bayside

population_comparison_table$x18plus_share_rest_of_melbourne <- population_comparison_table$x18plus_rest_of_melbourne / population_comparison_table$total_population_rest_of_melbourne

population_comparison_table$x18plus_share_greater_melbourne <- population_comparison_table$x18plus_greater_melbourne / population_comparison_table$total_population_greater_melbourne

# plot giant comparison table
kable(population_comparison_table %>% 
        adorn_pct_formatting(,,,8:10), 
      caption = "City of Bayside and Rest of Greater Melbourne: population 18 and over, total, and share 18 and over",
      align = "lrrrrrrrrrr",
      format.args = list(big.mark = ",", scientific = FALSE),
      col.names = c("Year", 
                   "City of Bayside", "Rest of Greater Melbourne", "Total",
                   "City of Bayside", "Rest of Greater Melbourne", "Total",
                   "City of Bayside", "Rest of Greater Melbourne", "Total")
      ) %>% 
  column_spec(column = 8:10, ) %>%
  add_header_above(c("Census" =1, "18 years and older" = 3, "Total population" = 3, "Share 18 years and older" = 3))


# compares shares
#share_18_and_old <- population_comparison_table %>% 
#  select(Year, 
#  x18plus_bayside, 
#  x18plus_rest_of_melbourne, 
#  total_population_bayside, 
#  total_population_rest_of_melbourne)

#share_18_and_old$x17minus_bayside <- share_18_and_old$total_population_bayside - share_18_and_old$x18plus_bayside
#share_18_and_old$x17minus_rest_of_melbourne <- share_18_and_old$total_population_rest_of_melbourne - share_18_and_old$x18plus_rest_of_melbourne

#share_18_and_old <- share_18_and_old %>% select(
#  Year, 
#  x17minus_bayside, 
#  x18plus_bayside,
#  x17minus_rest_of_melbourne,
#  x18plus_rest_of_melbourne
#)

#share_18_and_old

#kable(share_18_and_old %>% 
#        untabyl() %>%
#        adorn_totals(where = "col") %>%
#        adorn_percentages() %>% 
#        adorn_pct_formatting() %>% 
#        adorn_ns, 
#      caption = "City of Bayside and Rest of Greater Melbourne: population younger and older than 18",
#      align = "lrrrrr",
#      col.names = c("Year", 
#                   "under 18", "over 18", 
#                   "under 18", "over 18",
#                   "Total")) %>%
#        add_header_above(c("Census" = 1, "City of Bayside" = 2, "Rest of Melbourne" = 2, "Grand" = 1))



# compares shares
share_18_and_old_bayside <- population_comparison_table %>% 
  select(Year, 
  x18plus_bayside, 
  total_population_bayside)

share_18_and_old_bayside$x17_minus <- share_18_and_old_bayside$total_population_bayside - share_18_and_old_bayside$x18plus_bayside
share_18_and_old_bayside$area_of_interest <- "City of Bayside"
names(share_18_and_old_bayside) <- c("Year", "x18_plus", "total", "x17_minus", "area_of_interest")


share_18_and_old_rest_of_melbourne <- population_comparison_table %>% 
  select(Year, 
  x18plus_rest_of_melbourne, 
  total_population_rest_of_melbourne)
share_18_and_old_rest_of_melbourne$x17_minus <- share_18_and_old_rest_of_melbourne$total_population_rest_of_melbourne - share_18_and_old_rest_of_melbourne$x18plus_rest_of_melbourne
share_18_and_old_rest_of_melbourne$area_of_interest <- "Rest of Melbourne"
names(share_18_and_old_rest_of_melbourne) <- c("Year", "x18_plus", "total", "x17_minus", "area_of_interest")

share_18_and_old <- add_row(share_18_and_old_bayside %>% 
                              select(Year, area_of_interest, x17_minus, x18_plus), 
                            share_18_and_old_rest_of_melbourne %>% 
                              select(Year, area_of_interest, x17_minus, x18_plus))

share_18_and_old <- share_18_and_old %>% arrange(Year)


kable(share_18_and_old %>% 
        untabyl() %>%
        adorn_totals(where = "col") %>%
        adorn_percentages() %>% 
        adorn_pct_formatting() %>% 
        adorn_ns, 
      caption = "City of Bayside and Rest of Greater Melbourne: population younger and older than 18",
      align = "llrrr",
      col.names = c("Year", "Location", "under 18", "over 18", "Total"))

share_18_and_old_longer <- share_18_and_old %>% 
  pivot_longer(cols = 3:4,
               names_to = "group", 
               values_to = "population")

grouped_ggbarstats(data = share_18_and_old_longer, 
                   x = group, 
                   y = area_of_interest, 
                   counts = population, 
                   grouping.var = Year, 
                   plotgrid.args = list(nrow = 3), 
                   xlab = "Age group", 
                   ylab = "Area")
                   

```


## Vehicle availabilty

The following table shows the total number of vehicles (excluding trucks etc.) parked at or near households on the night of the census.

```{r cars_per_dwelling_summarise_data, message=FALSE, warning=FALSE, echo=FALSE, echo=FALSE, fig.caption = "Total vehicles at or near household on the night of the census", fig.fullwidth = TRUE}

cars_per_dwelling_summary_table <- gccsa_dw_vehd_2021 %>%
  filter(vehd_number_of_motor_vehicles == "Greater Melbourne")

cars_per_dwelling_summary_table <- cars_per_dwelling_summary_table %>% 
  add_row(gccsa_dw_vehd_2016 %>%
  filter(vehd_number_of_motor_vehicles == "Greater Melbourne"))

cars_per_dwelling_summary_table <- cars_per_dwelling_summary_table %>% 
  add_row(gccsa_dw_vehd_2011 %>%
  filter(vehd_number_of_motor_vehicles == "Greater Melbourne"))

cars_per_dwelling_summary_table <- cars_per_dwelling_summary_table %>% 
  add_row(lga_dw_vehd_2021 %>%
  filter(vehd_number_of_motor_vehicles == "Bayside (Vic.)"))

cars_per_dwelling_summary_table <- cars_per_dwelling_summary_table %>% 
  add_row(lga_dw_vehd_2016 %>%
  filter(vehd_number_of_motor_vehicles == "Bayside (C)"))

cars_per_dwelling_summary_table <- cars_per_dwelling_summary_table %>% 
  add_row(lga_dw_vehd_2011 %>%
  filter(vehd_number_of_motor_vehicles == "Bayside (C)"))

cars_per_dwelling_summary_table$Year <- c(2021, 2016, 2011, 2021, 2016, 2011)

#replace first column with consistent place names
area_of_interest <- c("Greater Melbourne", "Greater Melbourne", "Greater Melbourne", "Bayside", "Bayside", "Bayside")
cars_per_dwelling_summary_table[["vehd_number_of_motor_vehicles"]] <- area_of_interest
colnames(cars_per_dwelling_summary_table)[colnames(cars_per_dwelling_summary_table) == "vehd_number_of_motor_vehicles"] <- "area_of_interest"

cars_per_dwelling_summary_table$total_cars <- 0

cars_per_dwelling_summary_table$total_cars <- cars_per_dwelling_summary_table$x1_motor_vehicle + 
  cars_per_dwelling_summary_table$x2_motor_vehicles * 2 + 
  cars_per_dwelling_summary_table$x3_motor_vehicles * 3 + 
  cars_per_dwelling_summary_table$x4_motor_vehicles * 4 + 
  cars_per_dwelling_summary_table$x5_motor_vehicles * 5 + 
  cars_per_dwelling_summary_table$x6_motor_vehicles * 6 + 
  cars_per_dwelling_summary_table$x7_motor_vehicles * 7 + 
  cars_per_dwelling_summary_table$x8_motor_vehicles * 8 + 
  cars_per_dwelling_summary_table$x9_motor_vehicles * 9 + 
  cars_per_dwelling_summary_table$x10_motor_vehicles * 10 + 
  cars_per_dwelling_summary_table$x11_motor_vehicles * 11 + 
  cars_per_dwelling_summary_table$x12_motor_vehicles * 12 + 
  cars_per_dwelling_summary_table$x13_motor_vehicles * 13 + 
  cars_per_dwelling_summary_table$x14_motor_vehicles * 14 + 
  cars_per_dwelling_summary_table$x15_motor_vehicles * 15 + 
  cars_per_dwelling_summary_table$x16_motor_vehicles * 16 + 
  cars_per_dwelling_summary_table$x17_motor_vehicles * 17 + 
  cars_per_dwelling_summary_table$x18_motor_vehicles * 18 + 
  cars_per_dwelling_summary_table$x19_motor_vehicles * 19 + 
  cars_per_dwelling_summary_table$x20_motor_vehicles * 20 + 
  cars_per_dwelling_summary_table$x21_motor_vehicles * 21 + 
  cars_per_dwelling_summary_table$x22_motor_vehicles * 22 + 
  cars_per_dwelling_summary_table$x23_motor_vehicles * 23 + 
  cars_per_dwelling_summary_table$x24_motor_vehicles * 24 + 
  cars_per_dwelling_summary_table$x25_motor_vehicles * 25 + 
  cars_per_dwelling_summary_table$x26_motor_vehicles * 26 + 
  cars_per_dwelling_summary_table$x27_motor_vehicles * 27 + 
  cars_per_dwelling_summary_table$x28_motor_vehicles * 28 + 
  cars_per_dwelling_summary_table$x29_motor_vehicles * 29 + 
  cars_per_dwelling_summary_table$x30_or_more_motor_vehicles * 30 

summary_table <- cars_per_dwelling_summary_table %>% 
  select(area_of_interest, Year, total_cars)

total_cars_summary_table <- cars_per_dwelling_summary_table %>% 
  select(area_of_interest, Year, total_cars) %>% 
  pivot_wider(
  names_from = area_of_interest, 
  values_from = total_cars
)


total_cars_summary_table$`Rest of Greater Melbourne` <- total_cars_summary_table$`Greater Melbourne` - total_cars_summary_table$Bayside
 
total_cars_summary_table <- total_cars_summary_table %>% 
  select(Year, Bayside, `Rest of Greater Melbourne`)

total_cars_summary_table$Year <- total_cars_summary_table$Year %>% 
  factor(levels = c("2011", "2016", "2021")) 

total_cars_summary_table <- total_cars_summary_table %>% 
  arrange(Year)

total_cars_summary_table %>%   
  adorn_totals(where = "col") %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>%
  kable(caption = "Total number of vehicles parked at or near household on the night of the census", 
        align = 'lrr', 
        format.args = list(big.mark = ","))

 ggbarstats(total_cars_summary_table %>% pivot_longer(
    cols = 2:3,
    names_to = "area_of_interest", 
    values_to = "Total cars"),
  y = Year, 
  x = area_of_interest, 
  counts = "Total cars")

```

There were over 11k more vehicles (+20%) at dwellings in Bayside in 2021 than 2011, but this rate of increase is less than the rest of Greater Melbourne (+31%). 

```{r cars_per_person_18_plus, message=FALSE, warning=FALSE, echo=FALSE, echo=FALSE, fig.caption = "Vehicles at or near household on the night of the census per person aged 18 years or older", fig.fullwidth = TRUE}

cars_per_18plus_summary_table <- total_cars_summary_table

cars_per_18plus_summary_table$Bayside <- cars_per_18plus_summary_table$Bayside / share_18_and_old_bayside$x18_plus
cars_per_18plus_summary_table$`Rest of Greater Melbourne` <- cars_per_18plus_summary_table$`Rest of Greater Melbourne` / share_18_and_old_rest_of_melbourne$x18_plus

cars_per_18plus_summary_table %>% kable(
  caption = "Vehicles at or near household on the night of the census per person aged 18 years or older",
  align = "lrr"
)



```

Vehicles per person 18 years or older is shown in the above table. This is 6-9% higher in Bayside than elsewhere. Bayside grew 5.9% from 2021 to 2011, while the rest of Melbourne grew 5.5%. 


## Journey to work

```{r jtw_summarise_data, message=FALSE, warning=FALSE, echo=FALSE, echo=FALSE, fig.caption = "Work and journey-to-work status on census day", fig.fullwidth = TRUE, fig.height= 15}


jtw_summary_table_function <- function(
    abs_jtw_wide_table = abs_jtw_wide_table){ 
  # tibble to hold abs stats
  jtw_summary_table_holding <- abs_jtw_wide_table
  # tibble to hold sums
  jtw_summary_table_holding_sums <- tibble(area_of_interest = jtw_summary_table_holding$area_of_interest)

  # add all train-involved together
  jtw_summary_table_holding_sums$train <- jtw_summary_table_holding[,grep("train", names(jtw_summary_table_holding))] %>% rowSums()
  # drop train-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("train", names(jtw_summary_table_holding)))]

  # add all bus-involved together
  jtw_summary_table_holding_sums$bus <- jtw_summary_table_holding[,grep("bus", names(jtw_summary_table_holding))] %>% rowSums()
  # drop bus-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("bus", names(jtw_summary_table_holding)))]

  # add all ferry-involved together
  jtw_summary_table_holding_sums$ferry <- jtw_summary_table_holding[,grep("ferry", names(jtw_summary_table_holding))] %>% rowSums()
  # drop ferry-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("ferry", names(jtw_summary_table_holding)))]

  # add all tram-involved together
  jtw_summary_table_holding_sums$tram <- jtw_summary_table_holding[,grep("tram", names(jtw_summary_table_holding))] %>% rowSums()
  # drop tram-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("tram", names(jtw_summary_table_holding)))]

  # add all taxi-involved together
  jtw_summary_table_holding_sums$taxi <- jtw_summary_table_holding[,grep("taxi", names(jtw_summary_table_holding))] %>% rowSums()
  # drop taxi-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("taxi", names(jtw_summary_table_holding)))]
  
  # add all car_as_driver-involved together
  jtw_summary_table_holding_sums$car_as_driver <- jtw_summary_table_holding[,grep("car_as_driver", names(jtw_summary_table_holding))] %>% rowSums()
  # drop car_as_driver-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("car_as_driver", names(jtw_summary_table_holding)))]


  # add all car_as_passenger-involved together
  jtw_summary_table_holding_sums$car_as_passenger <- jtw_summary_table_holding[,grep("car_as_passenger", names(jtw_summary_table_holding))] %>% rowSums()
  # drop car_as_passenger-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("car_as_passenger", names(jtw_summary_table_holding)))]

  # add all truck-involved together
  jtw_summary_table_holding_sums$truck <- jtw_summary_table_holding[,grep("truck", names(jtw_summary_table_holding))] %>% rowSums()
  # drop truck-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("truck", names(jtw_summary_table_holding)))]

  # add all motorbike_scooter-involved together
  jtw_summary_table_holding_sums$motorbike_scooter <- jtw_summary_table_holding[,grep("motorbike_scooter", names(jtw_summary_table_holding))] %>% rowSums()
  # drop motorbike_scooter-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("motorbike_scooter", names(jtw_summary_table_holding)))]

  # add all bicycle-involved together
  jtw_summary_table_holding_sums$bicycle <- jtw_summary_table_holding[,grep("bicycle", names(jtw_summary_table_holding))] %>% rowSums()
  # drop bicycle-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("bicycle", names(jtw_summary_table_holding)))]

  # add all other-involved together
jtw_summary_table_holding_sums$other <- jtw_summary_table_holding[,grep("other", names(jtw_summary_table_holding))] %>% rowSums()
  # drop other-involved from abs stats holding tibble
  jtw_summary_table_holding <- jtw_summary_table_holding[,-c(grep("other", names(jtw_summary_table_holding)))]

  # add walked_only
  jtw_summary_table_holding_sums$walked_only <- jtw_summary_table_holding$walked_only

  # add worked_at_home
  jtw_summary_table_holding_sums$worked_at_home <- jtw_summary_table_holding$worked_at_home

  # did_not_go_to_work
  jtw_summary_table_holding_sums$did_not_go_to_work <- jtw_summary_table_holding$did_not_go_to_work

  # not stated
  jtw_summary_table_holding_sums$not_stated <- jtw_summary_table_holding$not_stated

  # not-applicable
  jtw_summary_table_holding_sums$not_applicable <- jtw_summary_table_holding$not_applicable

  return(jtw_summary_table_holding_sums)
}


jtw_summary_table <- jtw_summary_table_function(
  abs_jtw_wide_table =(gccsa_ur_mtwp_2021 %>% 
                         filter(area_of_interest == "Greater Melbourne")))
jtw_summary_table <- add_row(jtw_summary_table, jtw_summary_table_function(
  abs_jtw_wide_table =(gccsa_ur_mtwp_2016 %>% 
                         filter(area_of_interest == "Greater Melbourne"))))
jtw_summary_table <- add_row(jtw_summary_table, jtw_summary_table_function(
  abs_jtw_wide_table =(gccsa_ur_mtwp_2011 %>% 
                         filter(area_of_interest == "Greater Melbourne"))))
jtw_summary_table <- add_row(jtw_summary_table, jtw_summary_table_function(
  abs_jtw_wide_table =(lga_ur_mtwp_2021 %>% 
                         filter(area_of_interest == "Bayside (Vic.)"))))
jtw_summary_table <- add_row(jtw_summary_table, jtw_summary_table_function(
  abs_jtw_wide_table =(lga_ur_mtwp_2016 %>% 
                         filter(area_of_interest == "Bayside (C)"))))
jtw_summary_table <- add_row(jtw_summary_table, jtw_summary_table_function(
  abs_jtw_wide_table =(lga_ur_mtwp_2011 %>% 
                         filter(area_of_interest == "Bayside (C)"))))

## Check that numbers are right
#jtw_summary_table %>% adorn_totals(where = "col") %>% select(Total)
#gccsa_ur_mtwp_2021 %>% 
#  filter(area_of_interest == "Greater Melbourne") %>%
#  adorn_totals(where = "col") %>% 
#  select(Total)
#gccsa_ur_mtwp_2016 %>% 
#  filter(area_of_interest == "Greater Melbourne") %>%
#  adorn_totals(where = "col") %>% 
#  select(Total)
#gccsa_ur_mtwp_2011 %>% 
#  filter(area_of_interest == "Greater Melbourne") %>%
#  adorn_totals(where = "col") %>% 
#  select(Total)
#lga_ur_mtwp_2021 %>% 
#  filter(area_of_interest == "Bayside (Vic.)") %>%
#  adorn_totals(where = "col") %>% 
#  select(Total)
#lga_ur_mtwp_2016 %>% 
#  filter(area_of_interest == "Bayside (C)") %>%
#  adorn_totals(where = "col") %>% 
#  select(Total)
#lga_ur_mtwp_2011 %>% 
#  filter(area_of_interest == "Bayside (C)") %>%
#  adorn_totals(where = "col") %>% 
#  select(Total)
## Yes, all checks out. 



#calculate Rest of Melbourne 
jtw_summary_table[7,-1] <- jtw_summary_table[1,-1] - jtw_summary_table[4,-1]
jtw_summary_table[8,-1] <- jtw_summary_table[2,-1] - jtw_summary_table[5,-1]
jtw_summary_table[9,-1] <- jtw_summary_table[3,-1] - jtw_summary_table[6,-1]


#replace first column with consistent place names
jtw_summary_table$area_of_interest <- c("Greater Melbourne", 
                                        "Greater Melbourne", 
                                        "Greater Melbourne", 
                                        "Bayside", 
                                        "Bayside", 
                                        "Bayside", 
                                        "Rest of Melbourne", 
                                        "Rest of Melbourne", 
                                        "Rest of Melbourne")


jtw_summary_table$Year <- as_factor(c(2021, 2016, 2011, 
                                      2021, 2016, 2011,
                                      2021, 2016, 2011))

jtw_summary_table <- jtw_summary_table[-(1:3),]

jtw_summary_table <- jtw_summary_table %>% 
  arrange(Year,area_of_interest)


tibble(year = jtw_summary_table$Year, 
       Location = jtw_summary_table$area_of_interest,
       Worked  = jtw_summary_table %>% 
         select(2:14) %>% 
         rowSums(),
       did_not_work = jtw_summary_table$did_not_go_to_work, 
       not_employed = jtw_summary_table$not_applicable,
       no_response = jtw_summary_table$not_stated
) %>% 
  adorn_totals(where = "col") %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>% 
  kable(caption = "Work and journey-to-work status on census day", 
        align = 'llrrrrr', 
        format.args = list(big.mark = ","),
        col.names = c("Year", 
                      "Location", 
                      "Worked", 
                      "Did not work", 
                      "Not employed", 
                      "Did not respond to JTW question", 
                      "Total")
  )

tibble(year = jtw_summary_table$Year, 
       location = jtw_summary_table$area_of_interest,
       Worked  = jtw_summary_table %>% 
         select(2:14) %>% 
         rowSums(),
       did_not_work = jtw_summary_table$did_not_go_to_work, 
       not_employed = jtw_summary_table$not_applicable
) %>% pivot_longer(
  cols = 3:5, 
  names_to = "status", 
  values_to = "count"
) %>% 
  grouped_ggbarstats(
    x = status,
    y = location, 
    grouping.var = year,
    counts = count,
    plotgrid.args = list(nrow = 3), 
    xlab = "Location", 
    ylab = "Activity share"
  )
  
              

       

```



```{r jtw_mode_wfh_share, message=FALSE, warning=FALSE, echo=FALSE, echo=FALSE, fig.caption = "Journey-to-work mode and WFH status on census day", fig.fullwidth = TRUE, fig.height= 20}

tibble(year = jtw_summary_table$Year, 
       location = jtw_summary_table$area_of_interest,
       pt  = jtw_summary_table %>% 
         select(2:5) %>% 
         rowSums(),
       driver = jtw_summary_table %>% 
         select(7, 9, 10) %>% 
         rowSums(),
       passenger = jtw_summary_table %>% 
         select(6, 8) %>% 
         rowSums(),
       bicycle = jtw_summary_table$bicycle,
       walked_only = jtw_summary_table$walked_only,
       other_mode = jtw_summary_table$other,
       worked_at_home = jtw_summary_table$worked_at_home) %>% 
  adorn_totals(where = "col") %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>% 
  kable(caption = "Journey-to-work mode and WFH status on census day", 
        align = 'llrrrrrrr', 
        format.args = list(big.mark = ","),
        col.names = c("Year", 
                      "Location", 
                      "Public Transport", 
                      "Private vehicle (driver)", 
                      "Private vehicle (passenger)", 
                      "Bicycle", 
                      "Walked only", 
                      "Other mode",
                      "Worked at home",
                      "Total")
  )

mode_activity <- tibble(year = jtw_summary_table$Year, 
       location = jtw_summary_table$area_of_interest,
       transit  = jtw_summary_table %>% 
         select(2:5) %>% 
         rowSums(),
       driver = jtw_summary_table %>% 
         select(7, 9, 10) %>% 
         rowSums(),
       passenger = jtw_summary_table %>% 
         select(6, 8) %>% 
         rowSums(),
       bicycle = jtw_summary_table$bicycle,
       walked_only = jtw_summary_table$walked_only,
       other_mode = jtw_summary_table$other,
       worked_at_home = jtw_summary_table$worked_at_home) %>% 
  pivot_longer(
  cols = 3:9, 
  names_to = "mode_activity", 
  values_to = "count"
) 

mode_activity$mode_activity <- mode_activity$mode_activity %>% as_factor()
levels(mode_activity$mode_activity) <- c("transit", "driver", "passenger", "bicycle", "walked_only", "other_mode", "worked_at_home")

mode_activity %>% 
  grouped_ggbarstats(
    x = mode_activity,
    y = location,
    counts = count,
    grouping.var = year, 
    plotgrid.args = list(nrow = 3), 
    xlab = "Location", 
    ylab = "Mode / activity share"
  )


mode_activity %>% filter(
  mode_activity != "worked_at_home") %>% 
  grouped_ggbarstats(
    x = mode_activity,
    y = location,
    counts = count,
    grouping.var = year, 
    plotgrid.args = list(nrow = 3), 
    xlab = "Location", 
    ylab = "Mode share"
  )


```


```{r jtw_transit_share, message=FALSE, warning=FALSE, echo=FALSE, echo=FALSE, fig.caption = "Transit mode share on census day", fig.fullwidth = TRUE, fig.height= 15}

tibble(year = jtw_summary_table$Year, 
       location = jtw_summary_table$area_of_interest,
       train  = jtw_summary_table$train, 
       bus = jtw_summary_table$bus, 
       tram = jtw_summary_table$tram, 
       ferry = jtw_summary_table$ferry) %>% 
  adorn_totals(where = "col") %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>% 
  kable(caption = "Transit mode share on census day", 
        align = 'llrrrrrrr', 
        format.args = list(big.mark = ","),
        col.names = c("Year", 
                      "Location", 
                      "Train", 
                      "Bus", 
                      "Tram", 
                      "Ferry", 
                      "Total" 
                     )
  )

tibble(year = jtw_summary_table$Year, 
       location = jtw_summary_table$area_of_interest,
       train  = jtw_summary_table$train, 
       bus = jtw_summary_table$bus, 
       tram = jtw_summary_table$tram) %>% 
  pivot_longer(
  cols = 3:5, 
  names_to = "mode", 
  values_to = "count"
) %>% 
  grouped_ggbarstats(
    x = mode,
    y = location, 
    counts = count,
    grouping.var = year, 
    plotgrid.args = list(nrow = 3), 
    xlab = "Location", 
    ylab = "Mode share"
  )
  

```


# Discussion and Conclusions

# References

```{r bib, include=FALSE}
# create a bib file for the R packages used in this document
knitr::write_bib(c('base', 'rmarkdown'), file = 'skeleton.bib')
```
